# プロジェクト構造説明

## ディレクトリツリー

```
forex01-kai/
├── lib.py                          # コアライブラリ（データロード、シミュレーション、トレーニング関数）
├── train.py                        # トレーニング実行スクリプト（マルチプロセス）
├── test_sim.py                     # シミュレーションテスト実行スクリプト
├── test_prod.py                    # 本番環境テスト実行スクリプト
│
├── train/                          # トレーニング関連
│   ├── input/                      # トレーニング用入力データ
│   │   ├── market/                 # 市場データ（フォワードレート、スポットレート）
│   │   │   ├── forward_rates_1w_*.csv    # 1週間フォワードレート（NY17, TK20, TK1630）
│   │   │   ├── spot_rates_*.csv          # スポットレート（NY17, TK20, TK1630）
│   │   │   ├── position_functions_6.csv  # 6通貨ペア用ポジション関数定義
│   │   │   ├── position_functions_7.csv  # 7通貨ペア用ポジション関数定義
│   │   │   └── old/                       # 旧データ（バックアップ）
│   │   └── position/              # ポジション関数定義ファイル
│   │       ├── position_functions_6.csv
│   │       └── position_functions_7.csv
│   └── output/                    # トレーニング結果
│       ├── detail/                # 詳細結果（現在は空）
│       └── summary/               # サマリー結果
│           ├── train_result_NY17NY17_A.csv  # NY17→NY17 戦略A トレーニング結果
│           ├── train_result_NY17NY17_B.csv  # NY17→NY17 戦略B トレーニング結果
│           ├── train_result_NY17NY17_C.csv  # NY17→NY17 戦略C トレーニング結果
│           ├── train_result_NY17TK20_A.csv  # NY17→TK20 戦略A トレーニング結果
│           ├── train_result_NY17TK20_B.csv  # NY17→TK20 戦略B トレーニング結果
│           └── train_result_NY17TK20_C.csv  # NY17→TK20 戦略C トレーニング結果
│
└── test/                          # テスト関連
    ├── input/                     # テスト用入力データ
    │   ├── input_by_train/       # トレーニング結果を入力として使用
    │   │   ├── train_result_NY17NY17_*.csv  # トレーニング結果（A, B, C）
    │   │   └── train_result_NY17TK20_*.csv  # トレーニング結果（A, B, C）
    │   ├── market/                # 市場データ（テスト用）
    │   │   ├── forward_rates_1w_*.csv
    │   │   ├── spot_rates_*.csv
    │   │   └── position_functions_*.csv
    │   └── position/              # ポジション関数定義
    │       ├── position_functions_6.csv
    │       └── position_functions_7.csv
    └── output/                    # テスト結果
        ├── detail/                # 詳細結果（ラグ別）
        │   ├── TK1630/           # TK1630（16:30）タイムゾーン結果
        │   │   ├── test_result_*_lag=1.csv      # ラグ1年の結果
        │   │   ├── test_result_*_lag=1_summary.csv
        │   │   ├── test_result_*_lag=1_weight.csv
        │   │   └── ... (lag=2,3,4,5)
        │   └── TK20/             # TK20（20:00）タイムゾーン結果
        ├── performance/           # パフォーマンス結果
        │   ├── performance_20250520.csv          # 日別パフォーマンス
        │   └── performance_summary_20250520.csv # パフォーマンスサマリー
        ├── prod/                 # 本番環境用出力
        │   └── WeightFX_20250520.csv            # 本番用ウェイトファイル
        └── summary/              # テスト結果サマリー
            ├── test_result_*_simple.csv          # シンプルリターン結果
            ├── test_result_*_compound.csv        # 複利リターン結果
            ├── test_result_*_compound_since2015.csv
            └── test_result_*_targetWeight.csv    # ターゲットウェイト
```

## ファイル説明一覧表

### ルートディレクトリ

| ファイル名 | 説明 |
|-----------|------|
| `lib.py` | **コアライブラリ**<br>・市場データのロード関数（NY17, TK20, TK1630）<br>・フォワードレート・スポットレートの処理<br>・ポジション関数の定義と読み込み<br>・ファクターリターン計算（戦略A/B/C）<br>・シミュレーション関数（トレーニング/テスト用）<br>・パフォーマンス評価関数<br>・トレーニング/テスト実行関数 |
| `train.py` | **トレーニング実行スクリプト**<br>・6つのトレーニングプロセスを並列実行<br>・NY17TK20/NY17NY17 × 戦略A/B/C の組み合わせ<br>・マルチプロセス処理で高速化 |
| `test_sim.py` | **シミュレーションテスト実行スクリプト**<br>・バックテスト用のテスト実行<br>・戦略A/B/Cを並列実行後、統合結果を生成<br>・コマンドライン引数で最終シミュレーション期間を指定 |
| `test_prod.py` | **本番環境テスト実行スクリプト**<br>・本番環境用のテスト実行<br>・火曜日のみ実行<br>・日付をコマンドライン引数で指定<br>・パフォーマンスとウェイトファイルを出力 |

### train/input/ ディレクトリ

| ファイル/ディレクトリ | 説明 |
|---------------------|------|
| `market/forward_rates_1w_ny17.csv` | NY17（17:00 NY時間）の1週間フォワードレート |
| `market/forward_rates_1w_tk20.csv` | TK20（20:00 東京時間）の1週間フォワードレート |
| `market/forward_rates_1w_tk1630.csv` | TK1630（16:30 東京時間）の1週間フォワードレート |
| `market/spot_rates_ny17.csv` | NY17のスポットレート |
| `market/spot_rates_tk20.csv` | TK20のスポットレート |
| `market/spot_rates_tk1630.csv` | TK1630のスポットレート |
| `market/position_functions_6.csv` | 6通貨ペア用ポジション関数定義（AUDUSD, CADUSD, CHFUSD, EURUSD, GBPUSD, NZDUSD） |
| `market/position_functions_7.csv` | 7通貨ペア用ポジション関数定義（上記+JPYUSD） |
| `position/position_functions_6.csv` | 6通貨ペア用ポジション関数定義（コピー） |
| `position/position_functions_7.csv` | 7通貨ペア用ポジション関数定義（コピー） |

### train/output/ ディレクトリ

| ファイル名 | 説明 |
|-----------|------|
| `summary/train_result_NY17NY17_A.csv` | NY17→NY17 戦略Aのトレーニング結果<br>（ハイパーパラメータとパフォーマンス指標） |
| `summary/train_result_NY17NY17_B.csv` | NY17→NY17 戦略Bのトレーニング結果 |
| `summary/train_result_NY17NY17_C.csv` | NY17→NY17 戦略Cのトレーニング結果 |
| `summary/train_result_NY17TK20_A.csv` | NY17→TK20 戦略Aのトレーニング結果 |
| `summary/train_result_NY17TK20_B.csv` | NY17→TK20 戦略Bのトレーニング結果 |
| `summary/train_result_NY17TK20_C.csv` | NY17→TK20 戦略Cのトレーニング結果 |

### test/input/ ディレクトリ

| ファイル/ディレクトリ | 説明 |
|---------------------|------|
| `input_by_train/` | トレーニング結果をテストの入力として使用<br>・`train_result_NY17NY17_*.csv`<br>・`train_result_NY17TK20_*.csv` |
| `market/` | テスト用市場データ（train/input/market/と同じ構造） |
| `position/` | テスト用ポジション関数定義 |

### test/output/ ディレクトリ

| ファイル/ディレクトリ | 説明 |
|---------------------|------|
| `detail/TK1630/` | TK1630タイムゾーンでの詳細テスト結果<br>・`*_lag=1~5.csv`: 各ラグ年のリターン結果<br>・`*_lag=*_summary.csv`: パフォーマンスサマリー<br>・`*_lag=*_weight.csv`: ウェイト情報 |
| `detail/TK20/` | TK20タイムゾーンでの詳細テスト結果 |
| `performance/performance_*.csv` | 日別パフォーマンスデータ |
| `performance/performance_summary_*.csv` | パフォーマンスサマリー（年別・全体） |
| `prod/WeightFX_*.csv` | 本番環境用ウェイトファイル（日付付き） |
| `summary/test_result_*_simple.csv` | シンプルリターン（単利）のテスト結果サマリー |
| `summary/test_result_*_compound.csv` | 複利リターンのテスト結果サマリー |
| `summary/test_result_*_compound_since2015.csv` | 2015年以降の複利リターン結果 |
| `summary/test_result_*_targetWeight.csv` | 統合ターゲットウェイト |

## 主要な概念

### タイムゾーン
- **NY17**: ニューヨーク時間17:00（月曜日）
- **TK20**: 東京時間20:00（火曜日）
- **TK1630**: 東京時間16:30（火曜日）

### 戦略タイプ
- **戦略A**: 標準偏差ベースのランキング戦略（6通貨ペア）
- **戦略B**: 平均からの乖離ベースのランキング戦略（7通貨ペア、JPYUSD含む）
- **戦略C**: パーセンテージ変化ベースのランキング戦略（6通貨ペア）

### データフロー
1. **トレーニング**: `train.py` → `lib.py` → `train/output/summary/`
2. **テスト（シミュレーション）**: `test_sim.py` → `test/input/input_by_train/` → `test/output/detail/` → `test/output/summary/`
3. **テスト（本番）**: `test_prod.py` → `test/output/prod/` + `test/output/performance/`

